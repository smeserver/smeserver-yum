diff -Nur -x '*.orig' -x '*.rej' smeserver-yum-1.2.0/root/sbin/e-smith/yum_update_dbs mezzanine_patched_smeserver-yum-1.2.0/root/sbin/e-smith/yum_update_dbs
--- smeserver-yum-1.2.0/root/sbin/e-smith/yum_update_dbs	2005-09-25 20:30:54.000000000 -0600
+++ mezzanine_patched_smeserver-yum-1.2.0/root/sbin/e-smith/yum_update_dbs	2007-06-07 12:19:50.000000000 -0600
@@ -22,6 +22,7 @@
 use esmith::ConfigDB;
 
 my $db = esmith::ConfigDB->open_ro or die "Couldn't open ConfigDB\n";
+my $restrict = $db->get_prop('yum', 'RestrictAvailable') || 'no';
 
 use constant YUM_CRON_FLAG => '/var/lock/subsys/yum';
 
@@ -57,8 +58,16 @@
 
     print DB "# Generated by $0: " . scalar localtime() . "\n";
 
-    open YUM, "-|", YUM_CMD . "list $list_option" or 
-	die "Couldn't call yum list $list_option\n";
+    if (($list_option eq 'available') && ($restrict ne 'no'))
+    {
+      open YUM, "-|", YUM_CMD . "list $list_option |grep $restrict" or
+        die "Couldn't call yum list $list_option |grep $restrict\n";
+    }
+    else
+    {
+      open YUM, "-|", YUM_CMD . "list $list_option" or
+        die "Couldn't call yum list $list_option\n";
+    }
 
     while ( <YUM> )
     {
